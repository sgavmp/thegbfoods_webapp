<!DOCTYPE html>
<html lang="es" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head th:include="base :: head">
</head>
<body>
	<header th:include="base :: header"> </header>
	<section class="container">
		<div id="modal"></div>
		<div class="row">
			<div class="col s10 offset-s1">
				<div class="card blue-grey darken-1">
					<form action="#" val:validate="${feed}" th:object="${feed}"
						method="post">
						<div class="card-content white-text">
							<span class="card-title" th:inline="text">Comprobar el
								sitio [[*{name}]]</span> <input type="hidden"
								th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
							<div class="row">
								<div class="input-field col s12">
									<input type="text" th:field="*{dateFormat}" /> <label
										for="dateFormat">Formato de la fecha(si hay que
										parsear de texto)</label>
								</div>
							</div>
							<div class="row">
								<div class="input-field col s12">
									<input type="text" th:field="*{urlNews}" /> <label
										id="labelUrl" for="urlRSS"
										th:text="'Url de la primera p&aacute;gina de noticias'">
									</label>
								</div>
							</div>
							<div class="html row">
								<div class="input-field col s12">
									<input type="text" th:field="*{newsLink}" /> <label
										for="newsLink">Clase CSS para seleccionar las noticias</label>
								</div>
							</div>
							<div class="html row">
								<div class="input-field col s12">
									<table>
										<thead>
											<tr>
												<th>Url a las p&aacute;ginas adicionales de noticias</th>
												<th>
													<button class="btn" type="submit" name="addPage">A&ntilde;adir
														p&aacute;gina</button>
												</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="row,rowStat : *{urlPages}">
												<td><input type="text"
													th:field="*{urlPages[__${rowStat.index}__]}" /></td>
												<td>
													<button th:value="${rowStat.index}" class="btn"
														type="submit" name="removePage">Remove row</button>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
							<div class="row">
								<div class="input-field col s12">
									<table>
										<thead>
											<tr>
												<th>Selectores de partes HTML</th>
												<th>
													<button class="btn" type="submit" name="addHtml">A&ntilde;adir
														selector</button>
												</th>
											</tr>
										</thead>
										<tbody>
											<tr th:each="row,rowStat : *{selectorHtml}">
												<td><input type="text"
													th:field="*{selectorHtml[__${rowStat.index}__].key}" /></td>
												<td><input type="text"
													th:field="*{selectorHtml[__${rowStat.index}__].value}" /></td>
												<td>
													<button th:value="${rowStat.index}" class="btn"
														type="submit" name="removeHtml">Remove row</button>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<div class="card-action">
							<button class="btn" type="submit">Comprobar</button>
							<button id="test" class="btn right" type="submit" name="testFeed">Probar
								sitio</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<section th:include="alerts :: alerts"></section>
	</section>
	<footer th:include="base :: footer"> </footer>
	<script th:inline="javascript">
		/*<![CDATA[*/
		$(document)
				.ready(
						function() {
							$('select').material_select();
							if (!$("#rss").is(":checked")) {
								$(".rss").hide();
								$(".html").show();
							} else {
								$(".rss").show();
								$(".html").hide();
							}
							$('#rss')
									.change(
											function() {
												if (!$("#rss").is(":checked")) {
													$(".rss").hide();
													$(".html").show();
													$("#labelUrl")
															.html(
																	"Url de la primera p&aacute;gina de noticias");
												} else {
													$(".rss").show();
													$(".html").hide();
													$("#labelUrl")
															.html(
																	"Url del RSS de noticias");
												}
											});
							$(".right").submit(function() {
								return false;
							});
							$("#test")
									.click(
											function(event) {
												$form = $(this).parents("form");
												$
														.post(
																$form
																		.attr("action"),
																$form
																		.serialize()
																		+ "&testFeed=",
																function(data) {
																	var response = jQuery
																			.parseJSON(JSON
																					.stringify(data));
																	var date = new Date(
																			response.pubDate);
																	$("#modal")
																			.html(
																					'<div id="modal1" class="modal">'
																							+ '<div class="modal-content">'
																							+ '<h4>Noticia obtenida del sitio</h4>'
																							+ '<p>Titulo de la noticia:'
																							+ response.title
																							+ '</p>'
																							+ '<p>Contenido de la noticia:'
																							+ response.content
																							+ '</p>'
																							+ '<p>Url de la noticia:'
																							+ response.url
																							+ '</p>'
																							+ '<p>Fecha de publicacion de la noticia:'
																							+ date
																							+ '</p>'
																							+ '</div>'
																							+ '<div class="modal-footer">'
																							+ '<a href="#!" class=" modal-action modal-close waves-effect waves-green btn-flat">Cerrar</a>'
																							+ '</div>'
																							+ '</div>');
																	$('#modal1')
																			.openModal();
																});
												return false;
											});
						});
		/*]]>*/
	</script>
</body>
</html>
